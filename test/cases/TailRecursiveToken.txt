program { (Single | Open "." Close)+ }

skip { spaces }

tokens {
  spaces { " "+ }

  Single { "`" toEnd }

  toEnd { "`" | [^`$] toEnd | "$" afterDollarToEnd }

  afterDollarToEnd { "`" | [^`{$] toEnd | "$" afterDollarToEnd }

  Open { "`" toBrace }

  toBrace { [^`$] toBrace | "$" afterDollarToBrace }

  afterDollarToBrace { "{" | [^`\{$] toBrace | "$" afterDollarToBrace }

  Close { "}" toEnd }
}

---

`foo`

==> Single

---

`foo${.}bar`

==> Open, Close

---

`$$` `$` `$${.}`

==> Single, Single, Open, Close
