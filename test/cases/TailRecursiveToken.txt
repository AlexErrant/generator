@top { (single | open "." close)+ }

@skip { spaces }

@tokens {
  spaces { " "+ }

  single:single { "`" toEnd }

  toEnd { "`" | [^`$] toEnd | "$" afterDollarToEnd }

  afterDollarToEnd { "`" | [^`{$] toEnd | "$" afterDollarToEnd }

  open:open { "`" toBrace }

  toBrace { [^`$] toBrace | "$" afterDollarToBrace }

  afterDollarToBrace { "{" | [^`\{$] toBrace | "$" afterDollarToBrace }

  close:close { "}" toEnd }
}

# Single part

`foo`

==> single

# Interpolation

`foo${.}bar`

==> open, close

# Dollar signs

`$$` `$` `$${.}`

==> single, single, open, close
